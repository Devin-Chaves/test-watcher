<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation</title>
    <style>
        /* ========================= DESKTOP MEGA ========================= */
        .ff-nav-container.ff-nav-container--animated {
            -webkit-backdrop-filter: blur(50px);
            backdrop-filter: blur(50px);
            background-color: #fffc;
        }

        @media (min-width: 992px) {
            .ff-nav-container.ff-nav-container--animated {
                border-radius: 16px;
                transition: height 220ms ease-out;
                will-change: height;
            }

            #ff-mega {
                overflow: hidden;
            }
        }

        /* Tablet breakpoint tweaks (992px - 1024px) */
        @media (min-width: 992px) and (max-width: 1024px) {
            .ff-mega__popular-item {
                min-width: 196px !important;
            }

            .ff-mega__popular-sub {
                display: block;
                max-width: 130px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
        }

        #ff-mega .ff-mega__panel {
            display: none;
            opacity: 0;
            transition: opacity 180ms ease-out;
        }

        #ff-mega .ff-mega__panel.ff-mega__panel--active {
            display: block;
        }

        #ff-mega .ff-mega__panel.ff-mega__panel--active.ff-mega__panel--visible {
            opacity: 1;
        }

        #ff-mega .ff-mega__cta {
            display: none;
            opacity: 0;
            transition: opacity 180ms ease-out;
        }

        #ff-mega .ff-mega__cta.ff-mega__cta--active {
            display: flex;
        }

        #ff-mega .ff-mega__cta.ff-mega__cta--active.ff-mega__cta--visible {
            opacity: 1;
        }

        /* ========================= MOBILE NAV (OUTSIDE SHELL) + CHROME BEHAVIOR ========================= */
        @media (min-width: 992px) {
            [data-nav-mobile] {
                display: none !important;
            }
        }

        @media (max-width: 991px) {
            [data-nav-mobile]{
                display: none;
                --ff-nav-mobile-top: 0px;
                --ff-nav-mobile-chrome-h: 56px;
            }

            [data-nav-mobile].ff-nav-mobile--open{
                display: block;
                position: fixed;
                left: 0;
                right: 0;
                top: var(--ff-nav-mobile-top);
                bottom: 0;
                z-index: 9999;
                background: rgba(0,0,0,0.5);
            }

            .ff-nav-mobile__track{
                position: absolute;
                inset: 0;
                width: 100%;
                height: 100%;
                background: #fff;
                overflow: hidden;
            }

            /* ---------- Floating chrome (ONLY on layer 2+) ---------- */
            .ff-nav-mobile__chrome{
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: var(--ff-nav-mobile-chrome-h);
                background: #fff;
                z-index: 10;
                display: none;
            }

            /* Remove border-top from first section in any panel */
            .ff-nav-mobile__panel .ff-nav-mobile__section:first-child {
                border-top: none;
            }

            [data-nav-mobile].ff-nav-mobile--chrome-on .ff-nav-mobile__chrome{
                display: block;
            }

            /* Layout matches your actual markup: [back link] [title div] [close link] */
            .ff-nav-mobile__chrome-inner{
                height: 100%;
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 0 16px;
            }

            .ff-nav-mobile__chrome-left{
                display: flex;
                align-items: center;
                justify-content: center;
                width: 44px;
                height: 44px;
                margin-left: -8px;
                text-decoration: none;
            }

            .ff-nav-mobile__chrome-back-icon{
                width: 20px;
                height: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .ff-nav-mobile__chrome-back-icon img{
                width: 20px;
                height: 20px;
                display: block;
            }

            .ff-nav-mobile__chrome-title{
                flex: 1 1 auto;
                font-size: 18px;
                font-weight: 500;
                line-height: 1;
                color: #111;
                text-align: left;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                padding-right: 8px;
            }

            .ff-nav-mobile__chrome-close{
                width: 44px;
                height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-right: -8px;
                text-decoration: none;
            }

            .ff-nav-mobile__chrome-close img{
                width: 20px;
                height: 20px;
                display: block;
            }

            /* Panels stack + fade */
            .ff-nav-mobile__panel{
                position: absolute;
                inset: 0;
                width: 100%;
                height: 100%;
                opacity: 0;
                pointer-events: none;
                transition: opacity 200ms ease-out;
                will-change: opacity;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                background: transparent;
                padding-top: 0;
            }

            /* When chrome is on, ALL panels get padded down */
            [data-nav-mobile].ff-nav-mobile--chrome-on .ff-nav-mobile__panel{
                padding-top: var(--ff-nav-mobile-chrome-h);
            }

            /* When chrome is on, hide any in-panel headers so spacing is clean */
            [data-nav-mobile].ff-nav-mobile--chrome-on .ff-nav-mobile__header{
                display: none !important;
            }

            .ff-nav-mobile__panel.ff-nav-mobile__panel--active{
                opacity: 1;
                pointer-events: auto;
            }

            @media (prefers-reduced-motion: reduce) {
                .ff-nav-mobile__panel {
                    transition: none;
                }
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .ff-nav-container.ff-nav-container--animated {
                transition: none;
            }
            #ff-mega .ff-mega__panel {
                transition: none;
            }
        }

        body.ff-nav-mobile-open {
            overflow: hidden;
        }
    </style>
</head>
<body>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const mqDesktop = window.matchMedia('(min-width: 992px)');
            const mqMobile = window.matchMedia('(max-width: 991px)');

            /* ========================= DESKTOP MEGA ========================= */
            (function initDesktopMega() {
                const shell = document.querySelector('.ff-nav-container');
                const navBar = shell?.querySelector('.ff-nav__bar');
                const mega = document.getElementById('ff-mega');
                if (!shell || !navBar || !mega) return;

                const panels = new Map();
                mega.querySelectorAll('[data-menu-panel]').forEach(p => panels.set(p.dataset.menuPanel, p));

                const ctas = new Map();
                mega.querySelectorAll('[data-menu-cta]').forEach(c => ctas.set(c.dataset.menuCta, c));

                const triggers = document.querySelectorAll('.ff-nav__links [data-menu-trigger]');
                if (!panels.size || !triggers.length) return;

                const EXTRA_PAD = 24;
                const CLOSE_DELAY = 150;

                let activeKey = null;
                let closeTimer = null;

                function getHeight(el) {
                    if (!el) return 0;
                    return el.offsetHeight;
                }

                function setHeight(key) {
                    const navH = navBar.offsetHeight || 0;
                    const panelH = key ? getHeight(panels.get(key)) : 0;
                    const ctaH = key ? getHeight(ctas.get(key)) : 0;
                    const extra = key ? EXTRA_PAD : 0;
                    shell.style.height = (navH + panelH + ctaH + extra) + 'px';
                }

                function open(key) {
                    if (activeKey === key) return;
                    activeKey = key;
                    panels.forEach((p, k) => {
                        p.classList.toggle('ff-mega__panel--active', k === key);
                        p.classList.remove('ff-mega__panel--visible');
                    });
                    ctas.forEach((c, k) => {
                        c.classList.toggle('ff-mega__cta--active', k === key);
                        c.classList.remove('ff-mega__cta--visible');
                    });
                    shell.classList.add('ff-nav-container--open');
                    setHeight(key);
                    // Wait a tick for display to apply, then fade in
                    requestAnimationFrame(() => {
                        requestAnimationFrame(() => {
                            panels.get(key)?.classList.add('ff-mega__panel--visible');
                            ctas.get(key)?.classList.add('ff-mega__cta--visible');
                        });
                    });
                }

                function close() {
                    if (!activeKey) return;
                    activeKey = null;
                    shell.classList.remove('ff-nav-container--open');
                    setHeight(null);
                    panels.forEach(p => p.classList.remove('ff-mega__panel--visible', 'ff-mega__panel--active'));
                    ctas.forEach(c => c.classList.remove('ff-mega__cta--visible', 'ff-mega__cta--active'));
                }

                // Initialize
                shell.classList.add('ff-nav-container--animated');
                setHeight(null);

                // Event handlers
                triggers.forEach(t => {
                    t.addEventListener('mouseenter', () => {
                        clearTimeout(closeTimer);
                        open(t.dataset.menuTrigger);
                    });
                });

                shell.addEventListener('mouseleave', () => {
                    clearTimeout(closeTimer);
                    closeTimer = setTimeout(close, CLOSE_DELAY);
                });

                shell.addEventListener('mouseenter', () => clearTimeout(closeTimer));
            })();

            /* ========================= MOBILE NAV (STACK + FADE) + CHROME (LAYER 2+ ONLY) ========================= */
            (function initMobileNav(){
                const mobileRoot = document.querySelector('[data-nav-mobile]');
                const toggleBtn = document.querySelector('[data-nav-toggle]');
                if (!mobileRoot || !toggleBtn) return;

                const panels = Array.from(mobileRoot.querySelectorAll('[data-mobile-panel]'));
                if (!panels.length) return;

                const panelByKey = new Map();
                panels.forEach(p => panelByKey.set(p.getAttribute('data-mobile-panel'), p));

                const chromeTitleEl = mobileRoot.querySelector('[data-mobile-chrome-title]');

                const NAV_H = 56;
                let isOpen = false;
                let stack = ['root'];
                let lastFocus = null;

                function currentKey(){
                    return stack[stack.length - 1] || 'root';
                }

                function getPanelTitle(key){
                    const panel = panelByKey.get(key);
                    if (!panel) return '';

                    const dt = (panel.dataset && panel.dataset.panelTitle) ? panel.dataset.panelTitle : panel.getAttribute('data-panel-title');
                    if (dt && String(dt).trim()) return String(dt).trim();

                    const labelled = panel.getAttribute('aria-labelledby');
                    if (labelled) {
                        const el = document.getElementById(labelled);
                        if (el && el.textContent && el.textContent.trim()) return el.textContent.trim();
                    }

                    const t = panel.querySelector('.ff-nav-mobile__title');
                    if (t && t.textContent && t.textContent.trim()) return t.textContent.trim();
                    return '';
                }

                function syncChromeAndTop(){
                    const isSub = stack.length > 1;
                    mobileRoot.classList.toggle('ff-nav-mobile--chrome-on', isSub);
                    mobileRoot.style.setProperty('--ff-nav-mobile-top', (isSub ? 0 : NAV_H) + 'px');
                    if (chromeTitleEl) chromeTitleEl.textContent = isSub ? (getPanelTitle(currentKey()) || '') : '';
                }

                function setAria() {
                    toggleBtn.setAttribute('aria-expanded', String(isOpen));
                    toggleBtn.setAttribute('aria-label', isOpen ? 'Close primary navigation' : 'Open primary navigation');
                }

                function setActive(panelKey) {
                    panels.forEach(p => p.classList.remove('ff-nav-mobile__panel--active'));
                    const next = panelByKey.get(panelKey) || panelByKey.get('root');
                    if (next) next.classList.add('ff-nav-mobile__panel--active');
                    syncChromeAndTop();
                }

                function openMenu() {
                    if (!mqMobile.matches) return;
                    lastFocus = document.activeElement;
                    isOpen = true;
                    stack = ['root'];
                    mobileRoot.classList.add('ff-nav-mobile--open');
                    document.body.classList.add('ff-nav-mobile-open');
                    setActive('root');
                    setAria();
                    requestAnimationFrame(() => {
                        const active = panelByKey.get('root');
                        const focusable = active && active.querySelector('a, button, [tabindex]:not([tabindex="-1"])');
                        if (focusable) focusable.focus();
                    });
                }

                function closeMenu() {
                    isOpen = false;
                    mobileRoot.classList.remove('ff-nav-mobile--open');
                    mobileRoot.classList.remove('ff-nav-mobile--chrome-on');
                    mobileRoot.style.setProperty('--ff-nav-mobile-top', '0px');
                    document.body.classList.remove('ff-nav-mobile-open');
                    panels.forEach(p => p.classList.remove('ff-nav-mobile__panel--active'));
                    setAria();
                    if (lastFocus && typeof lastFocus.focus === 'function') lastFocus.focus();
                }

                function goTo(panelKey) {
                    if (!mqMobile.matches) return;
                    if (!panelByKey.has(panelKey)) return;
                    stack.push(panelKey);
                    setActive(panelKey);
                }

                function goBack(explicitKey) {
                    if (!mqMobile.matches) return;
                    if (explicitKey && panelByKey.has(explicitKey)) {
                        const idx = stack.lastIndexOf(explicitKey);
                        stack = idx >= 0 ? stack.slice(0, idx + 1) : [explicitKey];
                        setActive(currentKey());
                        return;
                    }
                    if (stack.length > 1) stack.pop();
                    setActive(currentKey());
                }

                closeMenu();
                toggleBtn.addEventListener('click', (e) => {
                    if (!mqMobile.matches) return;
                    e.preventDefault();
                    isOpen ? closeMenu() : openMenu();
                });

                mobileRoot.addEventListener('click', (e) => {
                    if (!mqMobile.matches) return;
                    if (!isOpen) return;
                    if (e.target === mobileRoot) closeMenu();
                });

                mobileRoot.addEventListener('click', (e) => {
                    if (!mqMobile.matches) return;
                    if (!isOpen) return;
                    const link = e.target.closest('a');
                    if (!link) return;
                    if (link.hasAttribute('data-mobile-chrome-close')) {
                        e.preventDefault();
                        closeMenu();
                        return;
                    }
                    if (link.hasAttribute('data-mobile-chrome-back')) {
                        e.preventDefault();
                        goBack();
                        return;
                    }
                    const to = link.getAttribute('data-mobile-target');
                    if (to) {
                        e.preventDefault();
                        goTo(to);
                        return;
                    }
                    const back = link.getAttribute('data-mobile-back');
                    if (back) {
                        e.preventDefault();
                        goBack(back);
                        return;
                    }
                    const href = link.getAttribute('href') || '';
                    const isHashOnly = href === '#' || href.startsWith('#');
                    if (isHashOnly) e.preventDefault();
                    else closeMenu();
                });

                document.addEventListener('keydown', (e) => {
                    if (!mqMobile.matches) return;
                    if (!isOpen) return;
                    if (e.key === 'Escape') closeMenu();
                });

                window.addEventListener('resize', () => {
                    if (!mqMobile.matches) return;
                    if (!isOpen) return;
                    syncChromeAndTop();
                });

                mqMobile.addEventListener('change', (e) => {
                    if (!e.matches && isOpen) closeMenu();
                });

                setAria();
            })();
        });
    </script>
</body>
</html>
