<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation</title>
    <style>
        /* ========================= DESKTOP MEGA ========================= */
        .ff-nav__link p {
            pointer-events: none;
        }

        .ff-nav-container.ff-nav-container--animated {
            -webkit-backdrop-filter: blur(50px);
            backdrop-filter: blur(50px);
            background-color: #fffc;
        }

        body.ff-nav-mobile-open .ff-nav-container {
            background-color: #fff;
        }

        /* Swap hamburger/close icons when mobile nav is open */
        .ff-nav__toggle__close-img {
            opacity: 0;
        }

        body.ff-nav-mobile-open .ff-nav__toggle__open-img {
            opacity: 0;
        }

        body.ff-nav-mobile-open .ff-nav__toggle__close-img {
            opacity: 1;
        }

        @media (min-width: 992px) {
            .ff-nav-container.ff-nav-container--animated {
                border-radius: 16px;
                transition: height 220ms ease-out;
                will-change: height;
            }

            #ff-mega {
                overflow: hidden;
            }
        }

        /* Tablet breakpoint tweaks (992px - 1024px) */
        @media (min-width: 992px) and (max-width: 1024px) {
            .ff-mega__col--popular {
                max-width: 220px;
            }

            .ff-mega__popular-item {
                min-width: 196px !important;
            }

            .ff-mega__popular-sub {
                display: block;
                max-width: 130px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
        }

        #ff-mega .ff-mega__panel {
            display: none;
            opacity: 0;
            transition: opacity 180ms ease-out;
        }

        #ff-mega .ff-mega__panel.ff-mega__panel--active {
            display: block;
        }

        #ff-mega .ff-mega__panel.ff-mega__panel--active.ff-mega__panel--visible {
            opacity: 1;
        }

        #ff-mega .ff-mega__cta {
            display: none;
            opacity: 0;
            transition: opacity 180ms ease-out;
        }

        #ff-mega .ff-mega__cta.ff-mega__cta--active {
            display: flex;
        }

        #ff-mega .ff-mega__cta.ff-mega__cta--active.ff-mega__cta--visible {
            opacity: 1;
        }

        /* ========================= MOBILE NAV (OUTSIDE SHELL) + CHROME BEHAVIOR ========================= */
        @media (min-width: 992px) {
            [data-nav-mobile] {
                display: none !important;
            }
        }

        @media (max-width: 991px) {
            .ff-nav-container {
                position: relative;
                z-index: 2;
            }

            [data-nav-mobile]{
                display: none;
                --ff-nav-mobile-chrome-h: 56px;
            }

            [data-nav-mobile].ff-nav-mobile--open{
                display: block;
                position: absolute;
                left: 0;
                right: 0;
                top: 0;
                bottom: 0;
                height: 100vh;
                z-index: 1;
                background: rgba(0,0,0,0.5);
            }

            .ff-nav-mobile__track{
                position: absolute;
                top: var(--ff-nav-mobile-chrome-h);
                left: 0;
                right: 0;
                bottom: 0;
                width: 100%;
                background: #fff;
                overflow: hidden;
            }

            /* ---------- Floating chrome (ONLY on layer 2+) ---------- */
            .ff-nav-mobile__chrome{
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: var(--ff-nav-mobile-chrome-h);
                background: #fff;
                z-index: 10;
                display: none;
            }

            /* Remove border-top from first section in any panel */
            .ff-nav-mobile__panel .ff-nav-mobile__section:first-child {
                border-top: none;
            }

            [data-nav-mobile].ff-nav-mobile--chrome-on .ff-nav-mobile__chrome{
                display: block;
            }

            [data-nav-mobile].ff-nav-mobile--chrome-on{
                z-index: 3;
            }

            /* Layout matches your actual markup: [back link] [title div] [close link] */
            .ff-nav-mobile__chrome-inner{
                height: 100%;
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 0 16px;
            }

            .ff-nav-mobile__chrome-left{
                display: flex;
                align-items: center;
                justify-content: center;
                width: 44px;
                height: 44px;
                margin-left: -8px;
                text-decoration: none;
            }

            .ff-nav-mobile__chrome-back-icon{
                width: 20px;
                height: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .ff-nav-mobile__chrome-back-icon img{
                width: 20px;
                height: 20px;
                display: block;
            }

            .ff-nav-mobile__chrome-title{
                flex: 1 1 auto;
                font-size: 18px;
                font-weight: 500;
                line-height: 1;
                color: #111;
                text-align: left;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                padding-right: 8px;
            }

            .ff-nav-mobile__chrome-close{
                width: 44px;
                height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-right: -8px;
                text-decoration: none;
            }

            .ff-nav-mobile__chrome-close img{
                width: 20px;
                height: 20px;
                display: block;
            }

            /* Panels stack + fade */
            .ff-nav-mobile__panel{
                position: absolute;
                inset: 0;
                width: 100%;
                height: 100%;
                opacity: 0;
                pointer-events: none;
                transition: opacity 200ms ease-out;
                will-change: opacity;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                background: transparent;
                padding-top: 0;
                padding-bottom: 112px;
            }

            /* When chrome is on, hide any in-panel headers so spacing is clean */
            [data-nav-mobile].ff-nav-mobile--chrome-on .ff-nav-mobile__header{
                display: none !important;
            }

            .ff-nav-mobile__panel.ff-nav-mobile__panel--active{
                opacity: 1;
                pointer-events: auto;
            }

            @media (prefers-reduced-motion: reduce) {
                .ff-nav-mobile__panel {
                    transition: none;
                }
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .ff-nav-container.ff-nav-container--animated {
                transition: none;
            }
            #ff-mega .ff-mega__panel {
                transition: none;
            }
        }

        body.ff-nav-mobile-open {
            overflow: hidden;
        }
    </style>
</head>
<body>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            console.log('Nav JS | Fix nav link hover flicker | 2026-01-08T19:05');
            const mqMobile = window.matchMedia('(max-width: 991px)');
            
            /* ========================= DESKTOP MEGA ========================= */
            (function initDesktopMega() {
                const shell = document.querySelector('.ff-nav-container');
                const navBar = shell?.querySelector('.ff-nav__bar');
                const mega = document.getElementById('ff-mega');
                if (!shell || !navBar || !mega) return;

                const panels = new Map();
                mega.querySelectorAll('[data-menu-panel]').forEach(p => panels.set(p.dataset.menuPanel, p));

                const ctas = new Map();
                mega.querySelectorAll('[data-menu-cta]').forEach(c => ctas.set(c.dataset.menuCta, c));

                const triggers = document.querySelectorAll('.ff-nav__links [data-menu-trigger]');
                if (!panels.size || !triggers.length) return;

                const EXTRA_PAD = 24;
                const CLOSE_DELAY = 150;

                let activeKey = null;
                let closeTimer = null;

                function setHeight(key) {
                    const navH = navBar.offsetHeight;
                    const panelH = panels.get(key)?.offsetHeight || 0;
                    const ctaH = ctas.get(key)?.offsetHeight || 0;
                    shell.style.height = (navH + panelH + ctaH + (key ? EXTRA_PAD : 0)) + 'px';
                }

                function open(key) {
                    if (activeKey === key) return;
                    activeKey = key;
                    panels.forEach((p, k) => {
                        p.classList.toggle('ff-mega__panel--active', k === key);
                        p.classList.remove('ff-mega__panel--visible');
                    });
                    ctas.forEach((c, k) => {
                        c.classList.toggle('ff-mega__cta--active', k === key);
                        c.classList.remove('ff-mega__cta--visible');
                    });
                    shell.classList.add('ff-nav-container--open');
                    setHeight(key);
                    // Wait a tick for display to apply, then fade in
                    requestAnimationFrame(() => {
                        panels.get(key)?.classList.add('ff-mega__panel--visible');
                        ctas.get(key)?.classList.add('ff-mega__cta--visible');
                    });
                    // Close search
										document.dispatchEvent(new CustomEvent('quick-search:close'))

                }

                function close() {
                    if (!activeKey) return;
                    activeKey = null;
                    shell.classList.remove('ff-nav-container--open');
                    setHeight(null);
                    panels.forEach(p => p.classList.remove('ff-mega__panel--visible', 'ff-mega__panel--active'));
                    ctas.forEach(c => c.classList.remove('ff-mega__cta--visible', 'ff-mega__cta--active'));
                }

                // Initialize
                shell.classList.add('ff-nav-container--animated');
                setHeight(null);

                // Event handlers
                triggers.forEach(t => {
                    t.addEventListener('mouseenter', () => {
                        clearTimeout(closeTimer);
                        open(t.dataset.menuTrigger);
                    });
                });

                shell.addEventListener('mouseleave', () => {
                    clearTimeout(closeTimer);
                    closeTimer = setTimeout(close, CLOSE_DELAY);
                });

                shell.addEventListener('mouseenter', () => clearTimeout(closeTimer));
            })();

            /* ========================= MOBILE NAV (STACK + FADE) + CHROME (LAYER 2+ ONLY) ========================= */
            (function initMobileNav(){
                const mobileRoot = document.querySelector('[data-nav-mobile]');
                const toggleBtn = document.querySelector('[data-nav-toggle]');
                const toggleSearch = document.querySelector('[data-search-toggle]');
                if (!mobileRoot || !toggleBtn) return;

                const panels = Array.from(mobileRoot.querySelectorAll('[data-mobile-panel]'));
                if (!panels.length) return;

                const panelByKey = new Map();
                panels.forEach(p => panelByKey.set(p.getAttribute('data-mobile-panel'), p));

                const chromeTitleEl = mobileRoot.querySelector('[data-mobile-chrome-title]');

                let isOpen = false;
                let currentKey = 'root';
                let lastFocus = null;

                function syncChrome(){
                    const isSub = currentKey !== 'root';
                    mobileRoot.classList.toggle('ff-nav-mobile--chrome-on', isSub);
                    if (chromeTitleEl) chromeTitleEl.textContent = isSub ? (panelByKey.get(currentKey)?.dataset.panelTitle?.trim() || '') : '';
                }

                function setAria() {
                    toggleBtn.setAttribute('aria-expanded', String(isOpen));
                    toggleBtn.setAttribute('aria-label', isOpen ? 'Close primary navigation' : 'Open primary navigation');
                }

                function setActive(key) {
                    currentKey = key;
                    panels.forEach(p => p.classList.remove('ff-nav-mobile__panel--active'));
                    const next = panelByKey.get(key) || panelByKey.get('root');
                    if (next) next.classList.add('ff-nav-mobile__panel--active');
                    syncChrome();
                }

                function openMenu() {
                    if (!mqMobile.matches) return;
                    lastFocus = document.activeElement;
                    isOpen = true;
                    mobileRoot.classList.add('ff-nav-mobile--open');
                    document.body.classList.add('ff-nav-mobile-open');
                    setActive('root');
                    setAria();
                    requestAnimationFrame(() => {
                        const active = panelByKey.get('root');
                        const focusable = active && active.querySelector('a, button, [tabindex]:not([tabindex="-1"])');
                        if (focusable) focusable.focus();
                    });
                }

                function closeMenu() {
                    isOpen = false;
                    mobileRoot.classList.remove('ff-nav-mobile--open', 'ff-nav-mobile--chrome-on');
                    document.body.classList.remove('ff-nav-mobile-open');
                    panels.forEach(p => p.classList.remove('ff-nav-mobile__panel--active'));
                    setAria();
                    if (lastFocus?.focus) lastFocus.focus();
                }

                function goTo(key) {
                    if (!mqMobile.matches) return;
                    if (!panelByKey.has(key)) return;
                    setActive(key);
                }

                function goBack() {
                    if (!mqMobile.matches) return;
                    const panel = panelByKey.get(currentKey);
                    const parent = panel?.dataset.panelParent || 'root';
                    setActive(parent);
                }

                closeMenu();
                toggleBtn.addEventListener('click', (e) => {
                    if (!mqMobile.matches) return;
                    e.preventDefault();
                    isOpen ? closeMenu() : openMenu();
                });
                
                if (toggleSearch) {
                    toggleSearch.addEventListener('click', (e) => {
                        if (!mqMobile.matches) return;
                        e.preventDefault();
                        isOpen ? closeMenu() : openMenu();
                        // Open search
                        document.dispatchEvent(new CustomEvent('quick-search:open'))
                    });
                }

                mobileRoot.addEventListener('click', (e) => {
                    if (!mqMobile.matches) return;
                    if (!isOpen) return;

                    // Click on backdrop closes menu
                    if (e.target === mobileRoot) {
                        closeMenu();
                        return;
                    }

                    // Handle link clicks
                    const link = e.target.closest('a');
                    if (!link) return;

                    if (link.hasAttribute('data-mobile-chrome-close')) {
                        e.preventDefault();
                        closeMenu();
                        return;
                    }
                    if (link.hasAttribute('data-mobile-chrome-back')) {
                        e.preventDefault();
                        goBack();
                        return;
                    }
                    const to = link.getAttribute('data-mobile-target');
                    if (to) {
                        e.preventDefault();
                        goTo(to);
                        return;
                    }
                    const href = link.getAttribute('href') || '';
                    const isHashOnly = href === '#' || href.startsWith('#');
                    if (isHashOnly) e.preventDefault();
                    else closeMenu();
                });

                document.addEventListener('keydown', (e) => {
                    if (!mqMobile.matches) return;
                    if (!isOpen) return;
                    if (e.key === 'Escape') closeMenu();
                });

                mqMobile.addEventListener('change', (e) => {
                    if (!e.matches && isOpen) closeMenu();
                });

                setAria();
            })();
        });
    </script>
</body>
</html>